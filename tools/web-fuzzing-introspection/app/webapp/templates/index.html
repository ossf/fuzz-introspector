{% extends "base.html" %}
{% block content %}
    <!-- main content -->
    <main>
      <!-- hero area -->
      <section class="hero__area">
        <div class="container">
          <div class="hero__wrapper">
            <h1 class="section__title">
              Fuzzing Introspection of OSS-Fuzz projects
            </h1>
            <p>
              This page shows stats and data on open source fuzzing of the
              projects integrated into OSS-Fuzz. The analysis is generated by
              Fuzz Introspector, which is our tool for analysing the quality of
              fuzzing for an open source project. The goal is to make the status
              transparent and useful for developers and researchers to identify
              if the code they use is properly analysed.
            </p>
            <div class="hero__btns">
                <a href="{{ url_for('site.projects_overview') }}" class="btn__primary">Projects overview</a>
                <a href="{{ url_for('site.function_search') }}" class="btn__primary">Search database</a>
            </div>
          </div>
        </div>
      </section>
      <!-- end hero area -->
      <!-- database overview -->
      <section class="overview">
        <div class="container">
          <div class="overview__wrapper">
            <h2 class="section__title">Database overview</h2>
            <div class="overview__content">
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter"> {{ db_summary.total_number_of_projects }}</span>
                </div>
                <p>Open source projects indexed</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter"> {{ db_summary.total_fuzzers }}</span>
                </div>
                <p>Fuzzers</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter"> {{ db_summary.total_functions }}</span>
                </div>
                <p>Functions</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter">{{ db_summary.language_count['c'] }}</span>
                </div>
                <p>C projects</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter">{{ db_summary.language_count['c++'] }}</span>
                </div>
                <p>C++ projects</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter">{{ db_summary.language_count['python'] }}</span>
                </div>
                <p>Python projects</p>
              </div>
              <!-- single overview -->
              <div class="single__overview">
                <div class="overvide__counter">
                  <span class="counter">{{ db_summary.language_count['java'] }}</span>
                </div>
                <p>Java projects</p>
              </div>
            </div>
          </div>

          <div class="overview__graph">
            <h3 class="sub__title">Progress over time</h3>
            <div class="graph__content">
              <!-- single item -->
              <div class="single__graph">
                <div class="graph__chart">
                    <div id="projectCountPlot" style="width:100%;max-width:500px"></div>
                </div>
                <p class="graph__title">Project count</p>
              </div>
              <!-- single item -->
              <div class="single__graph">
                <div class="graph__chart">
                    <div id="fuzzerCountPlot" style="width:100%;max-width:500px"></div>
                </div>
                <p class="graph__title">Fuzzer count</p>
              </div>
              <!-- single item -->
              <div class="single__graph">
                <div class="graph__chart">
                    <div id="functionCountPlot" style="width:100%;max-width:500px"></div>
                </div>
                <p class="graph__title">Function count</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="overview">
        <div class="container">
          <div class="overview__wrapper">
            <h2 class="section__title">Indexing projects</h2>
              <div style="padding-top: 5px;">
                <p>
                  <a class="btn btn__primary" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                    My project is on OSS-Fuzz but is not indexed?
                  </a>
                </p>
                <div class="collapse" id="collapseExample">
                  <div class="card card-body">
                    There are two main reasons for this:
                    <ol>
                        <li>
                            1) In order to index the project it needs to be analysed by Fuzz Introspector. Fuzz Introspector currently supports C/C++/Python/Java so if your project is in another language than this then it currently can't be indexed.
                        </li>
                        <li>
                            2) The OSS-Fuzz build is currently failing either code coverage builds or fuzz introspector builds, if any of these are failing then the project will not be indexed.
                        </li>
                    </ol>
                  </div>
                </div>
            </div>
            <div style="padding-top: 5px;">
              <p>
                <a class="btn btn__primary" data-bs-toggle="collapse" href="#addOssFuzzProject" role="button" aria-expanded="false" aria-controls="addOssFuzzProject">
                  I would like to add an open source project to the database, how do I do this?
                </a>
              </p>
              <div class="collapse" id="addOssFuzzProject">
                <div class="card card-body">
                  Any project integrated into https://github.com/google/oss-fuzz will be added to this database. Please add your project to OSS-Fuzz and it will be automatically indexed.
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- end database overview -->
    </main>
    <!-- end main content -->

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
// Plot for code coverage in terms of lines over time
const db_timestamp_x_axis = [];
const project_count_over_time = [];
const fuzzer_count_over_time = [];
const function_count_over_time = [];


{% for db_timestamp in db_timestamps %}
db_timestamp_x_axis.push("{{db_timestamp.date}}");
project_count_over_time.push({{db_timestamp.project_count}})
fuzzer_count_over_time.push({{db_timestamp.fuzzer_count}})
function_count_over_time.push({{db_timestamp.function_count}})
{%endfor%}


// Plot for code coverage in terms of lines over time
const project_count_over_time_data = [{
  x: db_timestamp_x_axis,
  y: project_count_over_time,
  mode:"lines"
}];
const project_count_over_time_layout = {
  xaxis: {title: "Date"},
  yaxis: {title: "Projects", range: [0.0, {{max_proj}}]},
  type: "scatter",
  paper_bgcolor: "rgba(0,0,0,0)",
  plot_bgcolor: "rgba(0,0,0,0)"
};
Plotly.newPlot("projectCountPlot", project_count_over_time_data, project_count_over_time_layout);

// Plot for fuzzer count over time
const fuzzer_count_over_time_data = [{
  x: db_timestamp_x_axis,
  y: fuzzer_count_over_time,
  mode:"lines"
}];
const fuzzer_count_over_time_layout = {
  xaxis: {title: "Date"},
        yaxis: {title: "Fuzzers", range: [0.0, {{max_fuzzer_count}}]},  
  type: "scatter",
  paper_bgcolor: "rgba(0,0,0,0)",
  plot_bgcolor: "rgba(0,0,0,0)"
};
Plotly.newPlot("fuzzerCountPlot", fuzzer_count_over_time_data, fuzzer_count_over_time_layout);


// Plot for function count over time
const function_count_over_time_data = [{
  x: db_timestamp_x_axis,
  y: function_count_over_time,
  mode:"lines"
}];
const function_count_over_time_layout = {
  xaxis: {title: "Date"},
        yaxis: {title: "Functions", range: [0.0, {{max_function_count}}]},  
  type: "scatter",
  paper_bgcolor: "rgba(0,0,0,0)",
  plot_bgcolor: "rgba(0,0,0,0)"
};
Plotly.newPlot("functionCountPlot", function_count_over_time_data, function_count_over_time_layout);
</script>    
{% endblock %}
